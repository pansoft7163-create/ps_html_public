<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker å®¹å™¨ä¿¡æ¯åˆ†æå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;
            --dark: #2d3748;
            --light: #f7fafc;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,32L48,53.3C96,75,192,117,288,117.3C384,117,480,75,576,90.7C672,107,768,181,864,197.3C960,213,1056,171,1152,138.7C1248,107,1344,85,1392,74.7L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
            pointer-events: none;
            opacity: 0.3;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.5s ease;
        }

        h1 {
            color: white;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: inline-flex;
            align-items: center;
            gap: 15px;
        }

        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.1em;
        }

        .input-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.6s ease;
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .input-header h2 {
            color: var(--dark);
            font-size: 1.5em;
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            background: var(--light);
            color: var(--dark);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            transition: all 0.3s;
            resize: vertical;
            background: #fafafa;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 1;
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            padding: 15px 30px;
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* å¿«é€Ÿè¿‡æ»¤å™¨ */
        .quick-filters {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: none;
        }

        .filter-title {
            font-size: 1.1em;
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--light);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.5s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #718096;
            margin-top: 8px;
            font-size: 0.95em;
        }

        .stat-change {
            font-size: 0.85em;
            margin-top: 5px;
            color: var(--success);
        }

        /* è­¦å‘Šå’Œæç¤º */
        .alerts-container {
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: slideIn 0.5s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .alert-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .alert-danger {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: #742a2a;
        }

        .alert-warning {
            background: #fffaf0;
            border-left: 4px solid var(--warning);
            color: #744210;
        }

        .alert-info {
            background: #ebf8ff;
            border-left: 4px solid var(--info);
            color: #2a4e7c;
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #22543d;
        }

        /* ç«¯å£åˆ†æ */
        .port-analysis {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .port-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .port-group {
            background: var(--light);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }

        .port-group-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .port-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            margin: 4px;
            font-weight: 500;
        }

        .port-redis { background: #fee; color: #c53030; }
        .port-postgres { background: #e6f3ff; color: #2c5aa0; }
        .port-http { background: #e6fffa; color: #047857; }
        .port-app { background: #fef3c7; color: #92400e; }
        .port-other { background: #f3e8ff; color: #6b21a8; }

        /* ä¸»è¡¨æ ¼ */
        .table-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .table-title {
            font-size: 1.5em;
            color: var(--dark);
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .search-box {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            width: 250px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }

        th:first-child {
            border-top-left-radius: 12px;
        }

        th:last-child {
            border-top-right-radius: 12px;
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }

        .container-name {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .container-id {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            color: #718096;
        }

        .image-name {
            color: var(--dark);
            font-weight: 500;
            max-width: 250px;
            word-break: break-word;
        }

        .image-tag {
            color: var(--primary);
            font-size: 0.9em;
        }

        .command {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            color: #718096;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }

        .command:hover {
            overflow: visible;
            white-space: normal;
            word-break: break-all;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            z-index: 5;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            display: inline-block;
        }

        .status-healthy {
            background: #d4edda;
            color: #155724;
        }

        .status-up {
            background: #cce5ff;
            color: #004085;
        }

        .status-exited {
            background: #f8d7da;
            color: #721c24;
        }

        .port-mapping {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            margin: 2px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            font-weight: 500;
        }

        .port-external {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fbbf24;
        }

        .port-internal {
            background: #dbeafe;
            color: #1e40af;
        }

        /* åº”ç”¨åˆ†ç»„è§†å›¾ */
        .app-groups {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .app-group-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .app-group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }

        .app-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }

        .app-group-name {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--dark);
        }

        .app-group-count {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
        }

        .app-container-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .app-container-item {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 8px;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .port-grid { grid-template-columns: 1fr; }
            .app-groups { grid-template-columns: 1fr; }
            .table-wrapper { font-size: 12px; }
            th, td { padding: 10px 8px; }
            .search-box { width: 150px; }
            .filter-buttons { justify-content: center; }
        }

        /* åŠ¨ç”» */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: var(--dark);
            color: white;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            pointer-events: none;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid var(--light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è§†å›¾åˆ‡æ¢ */
        .view-toggle {
            background: white;
            border-radius: 10px;
            padding: 4px;
            display: inline-flex;
            gap: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .view-btn {
            padding: 8px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: var(--dark);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        .view-btn:hover:not(.active) {
            background: var(--light);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>ğŸ³</span>
                <span>Docker å®¹å™¨ä¿¡æ¯åˆ†æå™¨</span>
            </h1>
            <p class="subtitle">å®æ—¶åˆ†æå’Œç®¡ç†æ‚¨çš„ Docker å®¹å™¨</p>
        </div>

        <div class="input-section">
            <div class="input-header">
                <h2>ğŸ“‹ è¾“å…¥ Docker å®¹å™¨ä¿¡æ¯</h2>
                <div class="input-actions">
                    <button class="btn-small" onclick="clearInput()">æ¸…ç©º</button>
                    <button class="btn-small" onclick="loadExample()">åŠ è½½ç¤ºä¾‹</button>
                </div>
            </div>
            <textarea id="dockerInput" placeholder="ç²˜è´´ docker ps æˆ– docker container ls çš„è¾“å‡ºå†…å®¹..."></textarea>
            <div class="button-group">
                <button class="btn-primary" onclick="parseDockerOutput()">
                    <span>ğŸ”</span>
                    <span>åˆ†æå®¹å™¨ä¿¡æ¯</span>
                </button>
                <button class="btn-secondary" onclick="exportData()">å¯¼å‡ºæŠ¥å‘Š</button>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p style="margin-top: 20px; color: white;">æ­£åœ¨åˆ†æå®¹å™¨ä¿¡æ¯...</p>
        </div>

        <div id="quickFilters" class="quick-filters">
            <div class="filter-title">ğŸ¯ å¿«é€Ÿè¿‡æ»¤</div>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterContainers('all')">å…¨éƒ¨</button>
                <button class="filter-btn" onclick="filterContainers('healthy')">å¥åº·å®¹å™¨</button>
                <button class="filter-btn" onclick="filterContainers('ports')">æœ‰ç«¯å£æ˜ å°„</button>
                <button class="filter-btn" onclick="filterContainers('maxkb')">MaxKB</button>
                <button class="filter-btn" onclick="filterContainers('dify')">Dify</button>
                <button class="filter-btn" onclick="filterContainers('database')">æ•°æ®åº“</button>
            </div>
        </div>

        <div id="alertsContainer" class="alerts-container"></div>

        <div id="statsContainer" class="stats-grid"></div>

        <div id="appGroupsContainer" class="app-groups" style="display: none;"></div>

        <div id="portAnalysis" class="port-analysis" style="display: none;">
            <h3>ğŸ”Œ ç«¯å£ä½¿ç”¨åˆ†æ</h3>
            <div id="portAnalysisContent"></div>
        </div>

        <div id="tableContainer" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">ğŸ“¦ å®¹å™¨è¯¦ç»†ä¿¡æ¯</div>
                <div class="table-actions">
                    <input type="text" id="searchInput" class="search-box" placeholder="æœç´¢å®¹å™¨..." onkeyup="searchContainers()">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="switchView('table')">è¡¨æ ¼</button>
                        <button class="view-btn" onclick="switchView('group')">åˆ†ç»„</button>
                    </div>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="containersTable">
                    <thead>
                        <tr>
                            <th>å®¹å™¨åç§°</th>
                            <th>å®¹å™¨ ID</th>
                            <th>é•œåƒ</th>
                            <th>å‘½ä»¤</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>çŠ¶æ€</th>
                            <th>ç«¯å£æ˜ å°„</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€æ•°æ®å­˜å‚¨
        let containersData = [];
        let currentFilter = 'all';

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadExample() {
            const exampleData = `CONTAINER ID   IMAGE                                       COMMAND                   CREATED             STATUS                       PORTS                                                                          NAMES
9df7471a0773   registry.fit2cloud.com/maxkb/maxkb:v2.2.1   "bash -c /usr/bin/stâ€¦"   25 minutes ago      Up 25 minutes (healthy)      5432/tcp, 6379/tcp, 0.0.0.0:9003->8080/tcp                                     maxkb
5f4497c0aaf6   registry.fit2cloud.com/maxkb/maxkb:v2.2.1   "bash -c /usr/bin/stâ€¦"   About an hour ago   Up About an hour (healthy)   5432/tcp, 8080/tcp, 127.0.0.1:6379->6379/tcp                                   redis
277b62894c09   registry.fit2cloud.com/maxkb/maxkb:v2.2.1   "bash -c /usr/bin/stâ€¦"   About an hour ago   Up About an hour (healthy)   6379/tcp, 127.0.0.1:5432->5432/tcp, 8080/tcp                                   pgsql
158e3410ffdb   nginx:latest                                "sh -c 'cp /docker-eâ€¦"   3 weeks ago         Up 3 weeks                   0.0.0.0:443->443/tcp, :::443->443/tcp, 0.0.0.0:9004->80/tcp, :::9004->80/tcp   docker-nginx-1
f6ba5cc935d8   langgenius/dify-api:1.7.1                   "/bin/bash /entrypoiâ€¦"   3 weeks ago         Up 3 weeks                   5001/tcp                                                                       docker-worker_beat-1
8812aa4c957c   langgenius/dify-api:1.7.1                   "/bin/bash /entrypoiâ€¦"   3 weeks ago         Up 3 weeks                   5001/tcp                                                                       docker-api-1
b0737800efa7   langgenius/dify-api:1.7.1                   "/bin/bash /entrypoiâ€¦"   3 weeks ago         Up 3 weeks                   5001/tcp                                                                       docker-worker-1
7ac888bf25d2   langgenius/dify-plugin-daemon:0.2.0-local   "/bin/bash -c /app/eâ€¦"   3 weeks ago         Up 3 weeks                   0.0.0.0:5003->5003/tcp, :::5003->5003/tcp                                      docker-plugin_daemon-1
ec2590773987   langgenius/dify-sandbox:0.2.12              "/main"                   3 weeks ago         Up 3 weeks (healthy)                                                                                        docker-sandbox-1
48d7292bd38c   langgenius/dify-web:1.7.1                   "/bin/sh ./entrypoinâ€¦"   3 weeks ago         Up 3 weeks                   3000/tcp                                                                       docker-web-1
12fccc32e7ec   redis:6-alpine                              "docker-entrypoint.sâ€¦"   3 weeks ago         Up 3 weeks (healthy)         6379/tcp                                                                       docker-redis-1
9c82aa0a8ec8   postgres:15-alpine                          "docker-entrypoint.sâ€¦"   3 weeks ago         Up 3 weeks (healthy)         5432/tcp                                                                       docker-db-1
666898bfea0f   semitechnologies/weaviate:1.19.0            "/bin/weaviate --hosâ€¦"   3 weeks ago         Up 3 weeks                                                                                                  docker-weaviate-1
1e1fbae690d8   ubuntu/squid:latest                         "sh -c 'cp /docker-eâ€¦"   3 weeks ago         Up 3 weeks                   3128/tcp                                                                       docker-ssrf_proxy-1
1108f2574317   xprobe/xinference:v0.16.3-cpu               "xinference-local -Hâ€¦"   3 weeks ago         Up 3 weeks                   0.0.0.0:9997->9997/tcp, :::9997->9997/tcp                                      xinference`;
            document.getElementById('dockerInput').value = exampleData;
        }

        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('dockerInput').value = '';
            containersData = [];
            hideResults();
        }

        // éšè—ç»“æœåŒºåŸŸ
        function hideResults() {
            document.getElementById('quickFilters').style.display = 'none';
            document.getElementById('statsContainer').innerHTML = '';
            document.getElementById('alertsContainer').innerHTML = '';
            document.getElementById('portAnalysis').style.display = 'none';
            document.getElementById('tableContainer').style.display = 'none';
            document.getElementById('appGroupsContainer').style.display = 'none';
        }

        // è§£æ Docker è¾“å‡º
        function parseDockerOutput() {
            const input = document.getElementById('dockerInput').value.trim();

            if (!input) {
                alert('è¯·è¾“å…¥ Docker å®¹å™¨ä¿¡æ¯ï¼');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('loading').classList.add('show');

            setTimeout(() => {
                try {
                    const lines = input.split('\n');
                    containersData = [];

                    // è·³è¿‡æ ‡é¢˜è¡Œ
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;

                        const parts = line.split(/\s{2,}/);
                        if (parts.length >= 7) {
                            containersData.push({
                                id: parts[0],
                                image: parts[1],
                                command: parts[2],
                                created: parts[3],
                                status: parts[4],
                                ports: parts[5],
                                names: parts[6]
                            });
                        }
                    }

                    if (containersData.length === 0) {
                        alert('æœªèƒ½è§£æåˆ°å®¹å™¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼ï¼');
                        document.getElementById('loading').classList.remove('show');
                        return;
                    }

                    // æ˜¾ç¤ºç»“æœ
                    displayResults();

                } catch (error) {
                    alert('è§£æé”™è¯¯ï¼š' + error.message);
                } finally {
                    document.getElementById('loading').classList.remove('show');
                }
            }, 500);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            displayStats();
            displayAlerts();
            displayPortAnalysis();
            displayTable();
            document.getElementById('quickFilters').style.display = 'block';
            document.getElementById('tableContainer').style.display = 'block';
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function displayStats() {
            const totalContainers = containersData.length;
            const runningContainers = containersData.filter(c => c.status.includes('Up')).length;
            const healthyContainers = containersData.filter(c => c.status.includes('healthy')).length;
            const withPorts = containersData.filter(c => c.ports && c.ports !== '').length;

            const stats = [
                { icon: 'ğŸ“¦', number: totalContainers, label: 'æ€»å®¹å™¨æ•°' },
                { icon: 'âœ…', number: runningContainers, label: 'è¿è¡Œä¸­' },
                { icon: 'ğŸ’š', number: healthyContainers, label: 'å¥åº·å®¹å™¨' },
                { icon: 'ğŸ”Œ', number: withPorts, label: 'ç«¯å£æ˜ å°„' }
            ];

            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-icon">${stat.icon}</div>
                    <div class="stat-number">${stat.number}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        // æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯
        function displayAlerts() {
            const alerts = [];

            // æ£€æŸ¥åœæ­¢çš„å®¹å™¨
            const stoppedContainers = containersData.filter(c => c.status.includes('Exited'));
            if (stoppedContainers.length > 0) {
                alerts.push({
                    type: 'danger',
                    icon: 'âš ï¸',
                    title: 'å‘ç°åœæ­¢çš„å®¹å™¨',
                    content: `æœ‰ ${stoppedContainers.length} ä¸ªå®¹å™¨å·²åœæ­¢è¿è¡Œï¼š${stoppedContainers.map(c => c.names).join(', ')}`
                });
            }

            // æ£€æŸ¥å…¬ç½‘ç«¯å£
            const publicPorts = containersData.filter(c => c.ports && c.ports.includes('0.0.0.0'));
            if (publicPorts.length > 0) {
                alerts.push({
                    type: 'warning',
                    icon: 'ğŸŒ',
                    title: 'å…¬ç½‘ç«¯å£æš´éœ²',
                    content: `æœ‰ ${publicPorts.length} ä¸ªå®¹å™¨æš´éœ²äº†å…¬ç½‘ç«¯å£ï¼Œè¯·æ³¨æ„å®‰å…¨è®¾ç½®`
                });
            }

            // æ£€æŸ¥æ²¡æœ‰å¥åº·æ£€æŸ¥çš„å®¹å™¨
            const noHealthCheck = containersData.filter(c => !c.status.includes('healthy') && c.status.includes('Up'));
            if (noHealthCheck.length > 0) {
                alerts.push({
                    type: 'info',
                    icon: 'â„¹ï¸',
                    title: 'ç¼ºå°‘å¥åº·æ£€æŸ¥',
                    content: `æœ‰ ${noHealthCheck.length} ä¸ªè¿è¡Œä¸­çš„å®¹å™¨æœªé…ç½®å¥åº·æ£€æŸ¥`
                });
            }

            if (alerts.length === 0) {
                alerts.push({
                    type: 'success',
                    icon: 'âœ…',
                    title: 'ä¸€åˆ‡æ­£å¸¸',
                    content: 'æ‰€æœ‰å®¹å™¨è¿è¡ŒçŠ¶æ€è‰¯å¥½'
                });
            }

            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = alerts.map(alert => `
                <div class="alert alert-${alert.type}">
                    <div class="alert-icon">${alert.icon}</div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div>${alert.content}</div>
                    </div>
                </div>
            `).join('');
        }

        // ç«¯å£åˆ†æ
        function displayPortAnalysis() {
            const portGroups = {
                redis: [],
                postgres: [],
                http: [],
                app: [],
                other: []
            };

            containersData.forEach(container => {
                if (!container.ports || container.ports === '') return;

                const ports = container.ports.split(',').map(p => p.trim());
                ports.forEach(port => {
                    if (port.includes('6379')) {
                        portGroups.redis.push({ container: container.names, port });
                    } else if (port.includes('5432')) {
                        portGroups.postgres.push({ container: container.names, port });
                    } else if (port.includes('80') || port.includes('443')) {
                        portGroups.http.push({ container: container.names, port });
                    } else if (port.includes('->')) {
                        portGroups.app.push({ container: container.names, port });
                    } else {
                        portGroups.other.push({ container: container.names, port });
                    }
                });
            });

            let html = '<div class="port-grid">';

            const groupConfig = [
                { key: 'redis', title: 'ğŸ”´ Redis ç«¯å£', class: 'port-redis' },
                { key: 'postgres', title: 'ğŸ˜ PostgreSQL ç«¯å£', class: 'port-postgres' },
                { key: 'http', title: 'ğŸŒ HTTP/HTTPS ç«¯å£', class: 'port-http' },
                { key: 'app', title: 'âš¡ åº”ç”¨ç«¯å£', class: 'port-app' },
                { key: 'other', title: 'ğŸ“Œ å…¶ä»–ç«¯å£', class: 'port-other' }
            ];

            groupConfig.forEach(config => {
                if (portGroups[config.key].length > 0) {
                    html += `
                        <div class="port-group">
                            <div class="port-group-title">${config.title}</div>
                            <div>
                                ${portGroups[config.key].map(item =>
                                    `<span class="port-badge ${config.class}" title="${item.container}">${item.port}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            html += '</div>';

            const portAnalysisElement = document.getElementById('portAnalysis');
            document.getElementById('portAnalysisContent').innerHTML = html;
            portAnalysisElement.style.display = 'block';
        }

        // æ˜¾ç¤ºè¡¨æ ¼
        function displayTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = containersData.map(container => {
                const statusClass = container.status.includes('healthy') ? 'status-healthy' :
                                   container.status.includes('Up') ? 'status-up' : 'status-exited';

                let portsHtml = '';
                if (container.ports && container.ports !== '') {
                    const ports = container.ports.split(',').map(p => p.trim());
                    portsHtml = ports.map(port => {
                        const isExternal = port.includes('0.0.0.0') || port.includes(':::');
                        return `<span class="port-mapping ${isExternal ? 'port-external' : 'port-internal'}">${port}</span>`;
                    }).join('');
                }

                return `
                    <tr data-container="${container.names}" data-image="${container.image}" data-status="${container.status}">
                        <td>
                            <div class="container-name">${container.names}</div>
                        </td>
                        <td>
                            <div class="container-id">${container.id}</div>
                        </td>
                        <td>
                            <div class="image-name">${container.image}</div>
                        </td>
                        <td>
                            <div class="command" title="${container.command}">${container.command}</div>
                        </td>
                        <td>${container.created}</td>
                        <td>
                            <span class="status-badge ${statusClass}">${container.status}</span>
                        </td>
                        <td>${portsHtml || '<span style="color: #cbd5e0;">æ— </span>'}</td>
                    </tr>
                `;
            }).join('');
        }

        // æœç´¢å®¹å™¨
        function searchContainers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // è¿‡æ»¤å®¹å™¨
        function filterContainers(filter) {
            currentFilter = filter;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const rows = document.querySelectorAll('#tableBody tr');

            rows.forEach(row => {
                let show = false;

                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'healthy':
                        show = row.dataset.status.includes('healthy');
                        break;
                    case 'ports':
                        show = row.querySelector('.port-mapping') !== null;
                        break;
                    case 'maxkb':
                        show = row.dataset.image.includes('maxkb') || row.dataset.container.includes('maxkb');
                        break;
                    case 'dify':
                        show = row.dataset.image.includes('dify') || row.dataset.container.includes('dify');
                        break;
                    case 'database':
                        show = row.dataset.image.includes('redis') ||
                               row.dataset.image.includes('postgres') ||
                               row.dataset.container.includes('redis') ||
                               row.dataset.container.includes('pgsql');
                        break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const tableView = document.querySelector('.table-wrapper');
            const groupView = document.getElementById('appGroupsContainer');

            if (view === 'table') {
                tableView.style.display = 'block';
                groupView.style.display = 'none';
            } else {
                tableView.style.display = 'none';
                displayGroupView();
                groupView.style.display = 'grid';
            }
        }

        // æ˜¾ç¤ºåˆ†ç»„è§†å›¾
        function displayGroupView() {
            const groups = {};

            containersData.forEach(container => {
                let groupName = 'å…¶ä»–';

                if (container.image.includes('maxkb') || container.names.includes('maxkb')) {
                    groupName = 'MaxKB';
                } else if (container.image.includes('dify') || container.names.includes('dify')) {
                    groupName = 'Dify';
                } else if (container.image.includes('redis')) {
                    groupName = 'Redis';
                } else if (container.image.includes('postgres')) {
                    groupName = 'PostgreSQL';
                } else if (container.image.includes('nginx')) {
                    groupName = 'Nginx';
                }

                if (!groups[groupName]) {
                    groups[groupName] = [];
                }
                groups[groupName].push(container);
            });

            const groupsContainer = document.getElementById('appGroupsContainer');
            groupsContainer.innerHTML = Object.entries(groups).map(([name, containers]) => `
                <div class="app-group-card">
                    <div class="app-group-header">
                        <div class="app-group-name">${name}</div>
                        <div class="app-group-count">${containers.length}</div>
                    </div>
                    <div class="app-container-list">
                        ${containers.map(c => `
                            <div class="app-container-item">
                                <span>${c.names}</span>
                                <span class="status-badge ${c.status.includes('healthy') ? 'status-healthy' : c.status.includes('Up') ? 'status-up' : 'status-exited'}">
                                    ${c.status.includes('Up') ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (containersData.length === 0) {
                alert('è¯·å…ˆåˆ†æå®¹å™¨ä¿¡æ¯ï¼');
                return;
            }

            const reportData = {
                generatedAt: new Date().toLocaleString('zh-CN'),
                totalContainers: containersData.length,
                runningContainers: containersData.filter(c => c.status.includes('Up')).length,
                healthyContainers: containersData.filter(c => c.status.includes('healthy')).length,
                containers: containersData
            };

            const reportText = `
Docker å®¹å™¨åˆ†ææŠ¥å‘Š
ç”Ÿæˆæ—¶é—´ï¼š${reportData.generatedAt}

ç»Ÿè®¡ä¿¡æ¯ï¼š
- æ€»å®¹å™¨æ•°ï¼š${reportData.totalContainers}
- è¿è¡Œä¸­ï¼š${reportData.runningContainers}
- å¥åº·å®¹å™¨ï¼š${reportData.healthyContainers}

è¯¦ç»†ä¿¡æ¯ï¼š
${containersData.map(c => `
å®¹å™¨åç§°ï¼š${c.names}
å®¹å™¨IDï¼š${c.id}
é•œåƒï¼š${c.image}
çŠ¶æ€ï¼š${c.status}
ç«¯å£ï¼š${c.ports || 'æ— '}
åˆ›å»ºæ—¶é—´ï¼š${c.created}
${'='.repeat(80)}
`).join('\n')}
`;

            // åˆ›å»ºä¸‹è½½
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `docker-analysis-${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½ç¤ºä¾‹æ•°æ®
        window.onload = function() {
            loadExample();
        };
    </script>
</body>
</html>
